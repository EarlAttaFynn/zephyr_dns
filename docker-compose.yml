services:
  # 1. The Front End: AdGuard Home
  adguard:
    container_name: adguard
    image: adguard/adguardhome:latest
    restart: unless-stopped
    # We use "host" network mode so AdGuard sees real client IPs (Laptop, Phone),
    # not just the Docker gateway IP (172.x.x.x).
    network_mode: host
    volumes:
      - ./adguard_work:/opt/adguardhome/work
      - ./adguard_conf:/opt/adguardhome/conf
    # No "ports" section needed because network_mode: host opens them all automatically.
    # It will listen on:
    # - 53 (DNS)
    # - 80/3000 (Web UI)

  # 2. The Back End: Unbound
  unbound:
    container_name: unbound
    image: madnuttah/unbound:latest
    restart: unless-stopped
    ports:
      - "5335:5335/tcp"
      - "5335:5335/udp"
    environment:
      TZ: 'America/New_York'
      UNBOUND_UID: 1000
      UNBOUND_GID: 1000
    # Unbound doesn't need host network, standard bridge is fine.
    # But since AdGuard is on 'host' mode, it will reach Unbound via localhost:5335.
